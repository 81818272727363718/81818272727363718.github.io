<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roblox Info Hub</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0d1117;
  --panel:#0f1623;
  --surface:#121b2b;
  --border:#1f2a3d;
  --muted:#96a3b8;
  --text:#e8eef6;
  --accent:#6dd0ff;
  --accent-2:#9cf0c9;
  --shadow:0 18px 48px rgba(0,0,0,.35);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:"Inter", system-ui, -apple-system, sans-serif;
  background:radial-gradient(circle at 20% 20%, rgba(109,208,255,.12), transparent 32%),
             radial-gradient(circle at 80% 30%, rgba(156,240,201,.12), transparent 32%),
             linear-gradient(180deg,#0b0f16 0%,#0d1117 55%,#0a0e15 100%);
  color:var(--text);
  min-height:100vh;
}
h1{margin:0;font-size:28px;letter-spacing:0.3px}
h2{margin:0 0 6px;font-size:18px}
h3{margin:0 0 6px;font-size:16px}
p{margin:6px 0 10px}
button{
  border-radius:12px;
  border:1px solid var(--border);
  background:linear-gradient(180deg,#1b2434 0%,#131a28 100%);
  color:var(--text);
  padding:10px 14px;
  font-weight:700;
  cursor:pointer;
  transition:all .12s ease;
}
button:hover,button.active{
  border-color:var(--accent);
  box-shadow:0 10px 24px rgba(109,208,255,.18);
}
input,textarea,select{
  width:100%;
  background:var(--surface);
  border:1px solid var(--border);
  color:var(--text);
  border-radius:12px;
  padding:12px 12px;
}
textarea{min-height:120px;resize:vertical}
.page{
  max-width:1200px;
  margin:0 auto;
  padding:28px 16px 48px;
}
.hero{
  display:flex;
  justify-content:space-between;
  gap:14px;
  align-items:flex-start;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:18px;
  padding:16px 18px;
  box-shadow:var(--shadow);
}
.hero small{color:var(--muted)}
.hero-pill{
  display:inline-flex;
  gap:8px;
  align-items:center;
  padding:6px 10px;
  border-radius:999px;
  background:rgba(109,208,255,.12);
  color:var(--accent);
  font-weight:700;
  font-size:12px;
}
.layout{
  display:grid;
  grid-template-columns:270px 1fr;
  gap:16px;
  margin-top:16px;
}
@media(max-width:900px){.layout{grid-template-columns:1fr}}
.sidebar{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:18px;
  box-shadow:var(--shadow);
  padding:12px;
  position:sticky;
  top:12px;
  height:fit-content;
}
.side-card{
  background:var(--surface);
  border:1px dashed rgba(150,163,184,.4);
  border-radius:14px;
  padding:12px;
  margin-bottom:10px;
}
.nav-list{display:flex;flex-direction:column;gap:8px;margin:10px 0 4px}
.nav-btn{width:100%;text-align:left;font-weight:600;display:flex;justify-content:space-between;align-items:center}
.nav-note{color:var(--muted);font-size:12px;line-height:1.5}
.content{
  display:flex;
  flex-direction:column;
  gap:14px;
}
.section{
  display:none;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:18px;
  padding:16px;
  box-shadow:var(--shadow);
}
.section.active{display:block}
.section-lede{color:var(--muted);margin-top:0}
.block-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;margin-top:12px}
.card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
  box-shadow:0 12px 30px rgba(0,0,0,.28);
}
.stack{display:flex;flex-direction:column;gap:10px}
.controls{display:flex;flex-wrap:wrap;gap:10px;position:relative}
.controls .field{flex:1;min-width:220px}
.tag{display:inline-block;padding:4px 10px;border-radius:999px;border:1px solid var(--border);color:var(--muted);font-size:12px;margin-right:6px}
.muted{color:var(--muted);font-size:13px}
.small{font-size:12px;color:var(--muted)}
.avatar-wrap{width:140px;height:140px;border-radius:16px;overflow:hidden;background:#0e1530;border:1px solid var(--border);display:flex;align-items:center;justify-content:center}
.avatar-wrap img{width:100%;height:100%;object-fit:cover;display:block}
.profile-head{display:flex;gap:12px;flex-wrap:wrap}
.table{width:100%;border-collapse:collapse;font-size:13px}
.table th,.table td{border-bottom:1px solid rgba(230,237,243,.08);padding:6px 6px;text-align:left}
.badge-pill{display:inline-block;padding:2px 8px;border-radius:999px;font-size:11px;margin-right:4px}
.badge-ok{background:rgba(0,255,140,.08);border:1px solid rgba(0,255,140,.5)}
.badge-warn{background:rgba(255,180,0,.08);border:1px solid rgba(255,200,0,.6)}
.badge-bad{background:rgba(255,40,100,.08);border:1px solid rgba(255,60,140,.7)}
.outfit-row{display:flex;gap:10px;overflow-x:auto;padding-bottom:6px}
.outfit-card{min-width:130px;background:#0b111b;border-radius:10px;padding:6px;border:1px solid var(--border);text-align:center;font-size:12px}
.outfit-card img{width:100%;border-radius:8px;display:block}
#suggestionsList{display:none;position:absolute;background:var(--surface);border:1px solid var(--border);border-radius:12px;margin-top:2px;width:100%;z-index:30;max-height:220px;overflow:auto}
.suggestion-item{padding:8px 9px;cursor:pointer;font-size:13px}
.suggestion-item:hover{background:#141c2a}
#loadingOverlay{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:200}
.spinner{width:60px;height:60px;border-radius:50%;border:4px solid rgba(255,255,255,.12);border-top-color:var(--accent);animation:spin .7s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
#popupOverlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:150}
.popup{background:var(--panel);border-radius:12px;border:1px solid var(--border);padding:12px;width:92%;max-width:520px;max-height:80vh;overflow:auto}
.popup-item{padding:6px 4px;border-bottom:1px solid #151a2a;font-size:13px;cursor:pointer}
.popup-item:hover{color:var(--accent)}
</style>
</head>
<body>
<div class="page">
  <div class="hero">
    <div>
      <h1>Roblox Info Hub</h1>
      <p class="muted">Quickly look up player profiles, awarded badges, game details, and outfit history in one page.</p>
    </div>
    <div class="hero-pill">Navigation made simple</div>
  </div>

  <div class="layout">
    <aside class="sidebar">
      <div class="side-card">
        <h3>Go to tool</h3>
        <div class="nav-list">
          <button class="nav-btn active" data-section="profile">Profile lookup <span>→</span></button>
          <button class="nav-btn" data-section="gameinfo">Game info by ID <span>→</span></button>
          <button class="nav-btn" data-section="avatar">Avatar outfits <span>→</span></button>
        </div>
        <div class="nav-note">Pick a tool to load its panel. Each section explains the input it needs and shows results below.</div>
      </div>
      <div class="side-card">
        <h3>Tips</h3>
        <ul class="small" style="padding-left:18px;margin:6px 0 0">
          <li>Use exact usernames for profiles and outfits.</li>
          <li>Game Info expects a universe ID (not place ID).</li>
          <li>Badge award dates load on demand to stay fast.</li>
        </ul>
      </div>
    </aside>

    <main class="content">
      <section id="profile" class="section active">
        <div class="stack">
          <div>
            <h2>Profile / Friends / Groups / Badges</h2>
            <p class="section-lede">Search a player by username. You can preview the avatar, browse friends and groups, and load badge award dates when needed.</p>
          </div>
          <div class="controls">
            <div class="field"><input id="rbxUser" placeholder="Roblox username"></div>
            <button id="rbxFetch">Fetch profile</button>
            <div id="suggestionsList"></div>
          </div>
          <div id="rbxResults" class="block-grid"></div>
          <div id="badgeSummaryArea" class="stack"></div>
        </div>
      </section>

      <section id="gameinfo" class="section">
        <div class="stack">
          <div>
            <h2>Game Info (Universe ID)</h2>
            <p class="section-lede">Enter a universe ID to see creator, genre, engagement stats, and vote ratios. This replaces the old game tracker.</p>
          </div>
          <div class="controls">
            <div class="field"><input id="giGameId" placeholder="Game ID (e.g. 606849621)"></div>
            <button id="giLoad">Get info</button>
          </div>
          <div id="giResult" class="card"></div>
        </div>
      </section>

      <section id="avatar" class="section">
        <div class="stack">
          <div>
            <h2>Avatar Evolution (Saved Outfits)</h2>
            <p class="section-lede">Look up a player to see their saved outfits and thumbnails. Great for comparing avatar changes over time.</p>
          </div>
          <div class="controls">
            <div class="field"><input id="avUser" placeholder="Username"></div>
            <button id="avLoad">Load outfits</button>
          </div>
          <div id="avResult" class="stack"></div>
        </div>
      </section>
    </main>
  </div>
</div>

<!-- POPUP -->
<div id="popupOverlay">
  <div class="popup">
    <h3 id="popupTitle"></h3>
    <input id="popupSearch" placeholder="Filter..." style="width:100%;margin-bottom:8px">
    <div id="popupContent"></div>
    <button onclick="closePopup()" style="margin-top:8px">Close</button>
  </div>
</div>

<!-- LOADING -->
<div id="loadingOverlay"><div class="spinner"></div></div>

<script>
// ---------- helpers ----------
const proxyWrap = u => `https://corsproxy.io/?${encodeURIComponent(u)}`;
async function fetchJson(url,opts){
  const res = await fetch(url,{mode:'cors',credentials:'omit',...opts});
  if(!res.ok) throw new Error(`HTTP ${res.status}`);
  return res.json();
}
async function tryMulti(urls,opts){
  for(const u of urls){
    try{ return await fetchJson(u,opts); }catch{}
  }
  return null;
}

// ---------- section nav ----------
document.querySelectorAll('.nav-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const id = btn.dataset.section;
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('.nav-btn').forEach(b=>b.classList.toggle('active',b===btn));
  });
});

// ---------- popup ----------
const popupOverlay = document.getElementById('popupOverlay');
const popupTitle = document.getElementById('popupTitle');
const popupContent = document.getElementById('popupContent');
const popupSearch = document.getElementById('popupSearch');
let popupItems = [], popupClick = null;
function showPopup(title,items,onClick){
  popupItems = items;
  popupClick = onClick || null;
  popupTitle.textContent = title;
  renderPopup(items);
  popupSearch.value='';
  popupOverlay.style.display='flex';
}
function renderPopup(list){
  popupContent.innerHTML = list.map(v=>`<div class="popup-item" data-v="${v}">${v}</div>`).join('');
  popupContent.querySelectorAll('.popup-item').forEach(el=>{
    el.onclick = ()=>{ if(popupClick) popupClick(el.dataset.v); };
  });
}
popupSearch.oninput = ()=>{
  const q = popupSearch.value.toLowerCase();
  renderPopup(popupItems.filter(v=>v.toLowerCase().includes(q)));
};
function closePopup(){ popupOverlay.style.display='none'; }

// ---------- loading ----------
const loading = document.getElementById('loadingOverlay');
const setLoading = on => loading.style.display = on?'flex':'none';

// ---------- lookup user ----------
const usernameEndpoints = [
  'https://users.roproxy.com/v1/usernames/users',
  'https://users.rprxy.xyz/v1/usernames/users',
  proxyWrap('https://users.roblox.com/v1/usernames/users')
];
async function lookupUser(name){
  const payload = {usernames:[name],excludeBannedUsers:false};
  for(const url of usernameEndpoints){
    try{
      const data = await fetchJson(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
      if(data?.data?.length) return data.data[0];
    }catch{}
  }
  throw new Error('Unable to reach Roblox user services.');
}

async function getUserProfile(id){
  return await tryMulti([
    `https://users.roproxy.com/v1/users/${id}`,
    `https://users.rprxy.xyz/v1/users/${id}`,
    proxyWrap(`https://users.roblox.com/v1/users/${id}`)
  ]);
}

// ---------- profile section ----------
const rbxInput = document.getElementById('rbxUser');
const rbxResults = document.getElementById('rbxResults');
const suggList = document.getElementById('suggestionsList');
let suggTimer=null;

rbxInput.oninput = ()=>{
  const q = rbxInput.value.trim();
  if(suggTimer) clearTimeout(suggTimer);
  if(q.length<3){ suggList.style.display='none'; return; }
  suggTimer = setTimeout(()=>searchSuggest(q),220);
};
async function searchSuggest(q){
  try{
    const data = await fetchJson(proxyWrap(`https://users.roblox.com/v1/users/search?keyword=${encodeURIComponent(q)}&limit=10`));
    if(!data?.data?.length){suggList.style.display='none';return;}
    suggList.innerHTML = data.data.map(u=>`<div class="suggestion-item" data-u="${u.name}">${u.displayName} (@${u.name})</div>`).join('');
    suggList.style.display='block';
    suggList.querySelectorAll('.suggestion-item').forEach(el=>{
      el.onclick = ()=>{rbxInput.value=el.dataset.u;suggList.style.display='none';renderProfile(el.dataset.u);};
    });
  }catch{ suggList.style.display='none'; }
}
document.getElementById('rbxFetch').onclick = ()=>renderProfile(rbxInput.value.trim());

async function renderProfile(username){
  if(!username) return;
  rbxResults.innerHTML = `<div class="card">Loading profile for <b>${username}</b>...</div>`;
  setLoading(true);
  try{
    const user = await lookupUser(username);
    const id = user.id;
    const profile = await getUserProfile(id);
    const friends = await tryMulti([
      `https://friends.roproxy.com/v1/users/${id}/friends?limit=200`,
      `https://friends.rprxy.xyz/v1/users/${id}/friends?limit=200`,
      proxyWrap(`https://friends.roblox.com/v1/users/${id}/friends?limit=200`)
    ]);
    const groups = await tryMulti([
      `https://groups.roproxy.com/v2/users/${id}/groups/roles`,
      `https://groups.rprxy.xyz/v2/users/${id}/groups/roles`,
      proxyWrap(`https://groups.roblox.com/v2/users/${id}/groups/roles`)
    ]);
    const badges = await tryMulti([
      `https://badges.roproxy.com/v1/users/${id}/badges?limit=100`,
      `https://badges.rprxy.xyz/v1/users/${id}/badges?limit=100`,
      proxyWrap(`https://badges.roblox.com/v1/users/${id}/badges?limit=100`)
    ]);

    const friendsList = (friends?.data||[]).map(f=>f.name);
    const groupsList = (groups?.data||[]).map(g=>`${g.group.name} — ${g.role?.name||'Member'}`);
    const badgeList = (badges?.data||[]).map(b=>b.name);

    rbxResults.innerHTML = '';

    const profileCard = document.createElement('div');
    profileCard.className='card';
    profileCard.innerHTML = `
      <h3>Profile</h3>
      <div class="profile-head">
        <div class="avatar-wrap" id="avatarSlot"><span class="small">Avatar preview ready</span></div>
        <div>
          <span class="tag">ID: ${id}</span><br>
          <b>${profile.displayName}</b><br>@${profile.name}<br>
          Created: ${profile.created? new Date(profile.created).toLocaleDateString(): 'Unknown'}<br>
          Description: <span class="small">${profile.description || '(none)'}</span>
        </div>
      </div>
    `;

    const avatarBtn = document.createElement('button');
    avatarBtn.textContent = 'Show avatar';
    avatarBtn.style.marginTop = '10px';
    avatarBtn.onclick = ()=>loadAvatar(id, profile.name);
    profileCard.appendChild(avatarBtn);
    rbxResults.appendChild(profileCard);

    function makeCard(title,body,list,onClickName){
      const c = document.createElement('div');
      c.className='card';
      c.innerHTML = `<h3>${title}</h3><p class="muted">${body}</p>`;
      if(list && list.length){
        const btn = document.createElement('button');
        btn.textContent='Show all';
        btn.onclick=()=>showPopup(title,list,onClickName);
        c.appendChild(btn);
      }
      rbxResults.appendChild(c);
    }

    makeCard('Friends',friendsList.slice(0,6).join(', ')||'None',friendsList,name=>renderProfile(name));
    makeCard('Groups',groupsList.slice(0,5).join('<br>')||'None',groupsList,null);
    if(badgeList.length) makeCard('Badges',badgeList.slice(0,5).join(', '),badgeList,null);

    const badgeArea = document.getElementById('badgeSummaryArea');
    badgeArea.innerHTML = '';
    const prompt = document.createElement('div');
    prompt.className='card';
    prompt.innerHTML = '<h3>Badge award dates</h3><p class="muted">Load this user\'s badges to see the most recent award dates without plotting a graph.</p>';
    const badgeBtn = document.createElement('button');
    badgeBtn.textContent = 'Load badge award dates';
    badgeBtn.onclick = ()=>loadBadgeAwards(id, profile.displayName || username);
    prompt.appendChild(badgeBtn);
    badgeArea.appendChild(prompt);

  }catch(err){
    rbxResults.innerHTML = `<div class="card"><h3>Error</h3><p>${err.message}</p></div>`;
  }
  setLoading(false);
}

async function loadAvatar(id, username){
  const slot = document.getElementById('avatarSlot');
  if(!slot) return;
  slot.textContent = 'Loading avatar...';
  try{
    const data = await tryMulti([
      `https://thumbnails.roproxy.com/v1/users/avatar?userIds=${id}&size=420x420&format=Png&isCircular=false`,
      proxyWrap(`https://thumbnails.roblox.com/v1/users/avatar?userIds=${id}&size=420x420&format=Png&isCircular=false`)
    ]);
    const url = data?.data?.[0]?.imageUrl;
    slot.innerHTML = url ? `<img src="${url}" alt="Avatar for ${username}">` : '<span class="small">No avatar preview available.</span>';
  }catch(err){
    slot.innerHTML = `<span class="small">Avatar preview failed: ${err.message}</span>`;
  }
}

// ---------- badges ----------
async function fetchAllBadges(userId){
  let cursor = null;
  const badges = [];
  for(let i=0;i<15;i++){
    const urlBase = cursor ?
      [
        `https://badges.roproxy.com/v1/users/${userId}/badges?limit=100&cursor=${cursor}`,
        proxyWrap(`https://badges.roblox.com/v1/users/${userId}/badges?limit=100&cursor=${cursor}`)
      ]:
      [
        `https://badges.roproxy.com/v1/users/${userId}/badges?limit=100&sortOrder=Desc`,
        proxyWrap(`https://badges.roblox.com/v1/users/${userId}/badges?limit=100&sortOrder=Desc`)
      ];
    const data = await tryMulti(urlBase);
    if(!data?.data?.length) break;
    badges.push(...data.data);
    cursor = data.nextPageCursor;
    if(!cursor) break;
  }
  return badges;
}

function renderBadgeAwards(target, badges, username){
  const card = document.createElement('div');
  card.className='card';
  card.innerHTML = '<h3>Badge award dates</h3>';
  const dated = badges.filter(b=>b.awardedDate).sort((a,b)=>new Date(b.awardedDate)-new Date(a.awardedDate));
  if(!dated.length){
    card.innerHTML += `<p class="muted">No award dates were returned for ${username}'s badges.</p>`;
    target.appendChild(card);
    return;
  }
  const summary = document.createElement('p');
  const first = new Date(dated[dated.length-1].awardedDate).toLocaleDateString();
  const last = new Date(dated[0].awardedDate).toLocaleDateString();
  summary.className='small';
  summary.textContent = `${dated.length} badges with award dates (from ${first} to ${last}).`;
  card.appendChild(summary);

  const table = document.createElement('table');
  table.className='table';
  table.innerHTML = '<tr><th style="width:60%">Badge</th><th>Awarded</th></tr>' +
    dated.slice(0,12).map(b=>`<tr><td>${b.name}</td><td>${new Date(b.awardedDate).toLocaleString()}</td></tr>`).join('');
  card.appendChild(table);
  target.appendChild(card);
}

async function loadBadgeAwards(userId, username){
  const target = document.getElementById('badgeSummaryArea');
  if(!target) return;
  target.innerHTML = '<div class="card"><h3>Badge award dates</h3><p class="muted">Fetching badge awards...</p></div>';
  setLoading(true);
  try{
    const fullBadges = await fetchAllBadges(userId);
    target.innerHTML = '';
    if(!fullBadges.length){
      const emptyCard = document.createElement('div');
      emptyCard.className='card';
      emptyCard.innerHTML = `<h3>Badge award dates</h3><p class="muted">No public badges available for ${username}.</p>`;
      target.appendChild(emptyCard);
      setLoading(false);
      return;
    }
    renderBadgeAwards(target, fullBadges, username);
  }catch(err){
    target.innerHTML = `<div class="card"><h3>Badge award dates</h3><p class="muted">Failed to load badge awards: ${err.message}</p></div>`;
  }
  setLoading(false);
}

// ---------- game info (universe id) ----------
document.getElementById('giLoad').onclick = ()=>loadGameInfo();

async function loadGameInfo(){
  const gameId = document.getElementById('giGameId').value.trim();
  const box = document.getElementById('giResult');
  if(!gameId){box.innerHTML='<div class="small">Enter a game ID to continue.</div>';return;}

  box.innerHTML='<div class="small">Fetching game details...</div>';
  setLoading(true);
  try{
    const gameData = await tryMulti([
      `https://games.roproxy.com/v1/games?universeIds=${gameId}`,
      `https://games.rprxy.xyz/v1/games?universeIds=${gameId}`,
      proxyWrap(`https://games.roblox.com/v1/games?universeIds=${gameId}`)
    ]);
    const game = gameData?.data?.[0];
    if(!game) throw new Error('No data found for that game ID.');

    const voteData = await tryMulti([
      `https://games.roproxy.com/v1/games/votes?universeIds=${gameId}`,
      `https://games.rprxy.xyz/v1/games/votes?universeIds=${gameId}`,
      proxyWrap(`https://games.roblox.com/v1/games/votes?universeIds=${gameId}`)
    ]);
    const votes = voteData?.data?.[0] || {};
    const likeRatio = votes.downVotes === 0 && votes.upVotes === 0 ? 'No votes yet' : `${Math.round((votes.upVotes/(votes.upVotes+votes.downVotes))*100)}%`;

    const fields = [
      {label:'Creator', value:`${game.creator?.name||'Unknown'} (ID: ${game.creator?.id||'—'})`},
      {label:'Genre', value:game.genre || 'Unknown'},
      {label:'Playing now', value:game.playing?.toLocaleString() || '0'},
      {label:'Total visits', value:game.visits?.toLocaleString() || '0'},
      {label:'Favorites', value:game.favoritedCount?.toLocaleString() || '0'},
      {label:'Like ratio', value:likeRatio}
    ];

    const rows = fields.map(f=>`<tr><th style="width:140px">${f.label}</th><td>${f.value}</td></tr>`).join('');

    box.innerHTML = `
      <div class="card">
        <h3>${game.name || 'Unknown title'}</h3>
        <p class="small">Game ID: ${gameId}</p>
        <table class="table">${rows}</table>
        <p class="small" style="margin-top:8px">Last updated: ${game.updated ? new Date(game.updated).toLocaleString() : 'Unknown'}</p>
        ${game.description ? `<p class="small">${game.description}</p>` : ''}
      </div>
    `;
  }catch(err){
    box.innerHTML=`<div class="card"><h3>Error</h3><p>${err.message}</p></div>`;
  }
  setLoading(false);
}

// ---------- avatar evolution / outfits ----------
document.getElementById('avLoad').onclick = async()=>{
  const username = document.getElementById('avUser').value.trim();
  const box = document.getElementById('avResult');
  if(!username){box.innerHTML='<div class="card">Enter a username.</div>';return;}
  box.innerHTML='<div class="card">Loading outfits...</div>';
  setLoading(true);
  try{
    const user = await lookupUser(username);
    const id = user.id;
    const outfits = await tryMulti([
      `https://avatar.roproxy.com/v1/users/${id}/outfits?itemsPerPage=50&page=1`,
      proxyWrap(`https://avatar.roblox.com/v1/users/${id}/outfits?itemsPerPage=50&page=1`)
    ]);
    if(!outfits?.data?.length){box.innerHTML='<div class="card">No public outfits found.</div>';setLoading(false);return;}
    const ids = outfits.data.map(o=>o.id).slice(0,50);
    const thumbData = await tryMulti([
      `https://thumbnails.roproxy.com/v1/users/outfits?userOutfitIds=${ids.join(',')}&size=150x150&format=Png&isCircular=false`,
      proxyWrap(`https://thumbnails.roblox.com/v1/users/outfits?userOutfitIds=${ids.join(',')}&size=150x150&format=Png&isCircular=false`)
    ]);
    const mapThumb = {};
    (thumbData?.data||[]).forEach(t=>{mapThumb[t.targetId]=t.imageUrl;});
    let html = `<div class="card"><h3>Outfits for ${username}</h3><div class="outfit-row">`;
    outfits.data.forEach(o=>{
      const url = mapThumb[o.id] || '';
      html += `
        <div class="outfit-card">
          ${url?`<img src="${url}" alt="${o.name}">`:''}
          <div>${o.name}</div>
          <div class="small">Outfit ID: ${o.id}</div>
        </div>
      `;
    });
    html += '</div><p class="small">These are saved outfits – basically an avatar evolution list.</p></div>';
    box.innerHTML = html;
  }catch(err){
    box.innerHTML = `<div class="card"><h3>Error</h3><p>${err.message}</p></div>`;
  }
  setLoading(false);
};

</script>
</body>
</html>
