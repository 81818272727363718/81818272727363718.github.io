<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roblox Lookup â€“ Neon Glass</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
body {
  margin:0;
  font-family:'Inter',sans-serif;
  background:#04050f;
  color:white;
  padding:20px;
}
.container {
  max-width:900px;
  margin:auto;
}
h1 {
  font-family:'Orbitron';
  text-align:center;
  margin-bottom:20px;
}
.controls {
  display:flex;
  gap:10px;
  margin-bottom:20px;
}
input {
  flex:1;
  padding:12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,0.15);
  background:rgba(255,255,255,0.07);
  color:white;
}
button {
  padding:12px 18px;
  border-radius:12px;
  border:none;
  background:rgba(0,255,255,0.2);
  border:1px solid rgba(0,255,255,0.3);
  color:white;
  cursor:pointer;
  font-weight:600;
  transition:0.2s;
}
button:hover {
  background:rgba(0,255,255,0.35);
}
.grid {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(230px,1fr));
  gap:14px;
}
.card {
  background:rgba(255,255,255,0.06);
  border:1px solid rgba(255,255,255,0.15);
  padding:16px;
  border-radius:14px;
  box-shadow:0 0 20px rgba(0,255,255,0.2);
}
.card h3 {
  margin-top:0;
}

/* Popup */
#popup {
  position:fixed;
  inset:0;
  display:none;
  justify-content:center;
  align-items:center;
  background:rgba(0,0,0,0.6);
  backdrop-filter:blur(6px);
  z-index:100;
}
.popup-box {
  background:rgba(255,255,255,0.06);
  border:1px solid rgba(0,255,255,0.35);
  padding:20px;
  border-radius:14px;
  width:90%;
  max-width:600px;
  max-height:70vh;
  overflow:auto;
  color:white;
}
</style>
</head>

<body>
<div class="container">
  <h1>Roblox Lookup</h1>

  <div class="controls">
    <input id="rbxUser" placeholder="Enter Roblox username">
    <button id="rbxFetch">Search</button>
  </div>

  <div id="rbxResults" class="grid"></div>
</div>

<!-- Popup -->
<div id="popup">
  <div class="popup-box">
    <h2 id="popupTitle"></h2>
    <div id="popupContent"></div>
    <button onclick="closePopup()" style="margin-top:10px;">Close</button>
  </div>
</div>

<script>
const proxyWrap=u=>`https://corsproxy.io/?${encodeURIComponent(u)}`;

async function fetchJson(url,opts={}){
  const res=await fetch(url,{...opts,headers:{'Content-Type':'application/json'}});
  if(!res.ok) throw new Error("HTTP "+res.status);
  return res.json();
}

// FIXED username lookups
async function lookupUser(name){
  const payload={usernames:[name]};
  const urls=[
    "https://users.roproxy.com/v1/usernames/users",
    "https://users.rprxy.xyz/v1/usernames/users",
    proxyWrap("https://users.roblox.com/v1/usernames/users")
  ];

  for(const u of urls){
    try{
      const data=await fetchJson(u,{method:"POST",body:JSON.stringify(payload)});
      if(data?.data?.length) return data.data[0];
    }catch{}
  }
  throw new Error("Failed to reach Roblox username API.");
}

function popup(title,items){
  document.getElementById("popupTitle").textContent=title;
  document.getElementById("popupContent").innerHTML=items.map(i=>`<div>${i}</div>`).join("");
  document.getElementById("popup").style.display="flex";
}
function closePopup(){ document.getElementById("popup").style.display="none"; }

async function render(){
  const results=document.getElementById("rbxResults");
  const username=document.getElementById("rbxUser").value || "builderman";
  results.innerHTML=`<div class="card"><p>Loading...</p></div>`;

  try {
    const user=await lookupUser(username);
    const id=user.id;

    const multi=async(arr)=>{
      for(const u of arr){
        try{ return await fetchJson(u); }catch{}
      }
      return null;
    };

    const profile = await multi([
      `https://users.roproxy.com/v1/users/${id}`,
      `https://users.rprxy.xyz/v1/users/${id}`,
      proxyWrap(`https://users.roblox.com/v1/users/${id}`)
    ]);

    const friends = await multi([
      `https://friends.roproxy.com/v1/users/${id}/friends?limit=200`,
      `https://friends.rprxy.xyz/v1/users/${id}/friends?limit=200`,
      proxyWrap(`https://friends.roblox.com/v1/users/${id}/friends?limit=200`)
    ]);

    const groups = await multi([
      `https://groups.roproxy.com/v2/users/${id}/groups/roles`,
      `https://groups.rprxy.xyz/v2/users/${id}/groups/roles`,
      proxyWrap(`https://groups.roblox.com/v2/users/${id}/groups/roles`)
    ]);

    const badges = await multi([
      `https://badges.roproxy.com/v1/users/${id}/badges?limit=200`,
      `https://badges.rprxy.xyz/v1/users/${id}/badges?limit=200`,
      proxyWrap(`https://badges.roblox.com/v1/users/${id}/badges?limit=200`)
    ]);

    const avatar = await multi([
      `https://avatar.roproxy.com/v1/users/${id}/avatar`,
      `https://avatar.rprxy.xyz/v1/users/${id}/avatar`,
      proxyWrap(`https://avatar.roblox.com/v1/users/${id}/avatar`)
    ]);

    const presenceData = await fetchJson(
      "https://presence.roproxy.com/v1/presence/users",
      {method:"POST",body:JSON.stringify({userIds:[id]})}
    );

    const presenceType = presenceData?.userPresences?.[0]?.userPresenceType;
    const presenceText = presenceType === 2 ? "In-Game" :
                         presenceType === 1 ? "Online" :
                         presenceType === 3 ? "Studio" : "Offline";

    const friendsList = (friends?.data||[]).map(f=>f.name);
    const groupList   = (groups?.data||[]).map(g=>g.group.name);
    const badgeList   = (badges?.data||[]).map(b=>b.name);

    const rap = (avatar?.assets||[])
        .reduce((n,a)=>n + (a.recentAveragePrice||0),0)
        .toLocaleString();

    results.innerHTML = "";

    // Cards
    function card(title,body,all=null){
      const div=document.createElement("div");
      div.className="card";
      div.innerHTML=`<h3>${title}</h3><p>${body}</p>`;
      if(all && all.length){
        const btn=document.createElement("button");
        btn.textContent="Show All";
        btn.onclick=()=>popup(title,all);
        div.appendChild(btn);
      }
      results.appendChild(div);
    }

    card("Profile",
      `<strong>${profile.displayName}</strong><br>@${profile.name}<br>
       Created: ${new Date(profile.created).toLocaleDateString()}`
    );

    card("Presence", presenceText);

    card("Friends", friendsList.slice(0,6).join(", ") || "None", friendsList);

    card("Groups", groupList.slice(0,6).join(", ") || "None", groupList);

    card("Badges", badgeList.slice(0,5).join(", ") || "None", badgeList);

    card("RAP", rap || "Unavailable");

  } catch(err){
    results.innerHTML=`<div class="card"><p>${err.message}</p></div>`;
  }
}

document.getElementById("rbxFetch").onclick=render;
</script>

</body>
</html>
