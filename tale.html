<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Plants vs Zombies â€“ Tile Clone</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: radial-gradient(circle at top, #2b5c2b 0, #062006 45%, #020603 100%);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    #game-container {
      background: rgba(0,0,0,0.35);
      border-radius: 18px;
      padding: 16px 16px 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.6);
      border: 1px solid rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
    }

    h1 {
      text-align: center;
      margin-bottom: 8px;
      letter-spacing: 1px;
      font-size: 24px;
      text-shadow: 0 0 6px #0f0;
    }

    #top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 8px;
    }

    #sun-counter {
      padding: 6px 10px;
      background: rgba(255,255,255,0.08);
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.18);
      font-size: 14px;
    }

    #status-text {
      font-size: 13px;
      opacity: 0.85;
    }

    button {
      cursor: pointer;
      border-radius: 999px;
      border: 0;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 600;
      background: linear-gradient(135deg, #39e27a, #8bf58d);
      color: #03240b;
      box-shadow: 0 0 12px rgba(0,0,0,0.4);
      transition: transform 0.1s ease, box-shadow 0.1s ease, opacity 0.1s ease, filter 0.15s;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 0 16px rgba(0,0,0,0.6);
      filter: brightness(1.05);
    }

    button:active {
      transform: translateY(1px);
      box-shadow: 0 0 8px rgba(0,0,0,0.4);
      filter: brightness(0.95);
    }

    button:disabled {
      opacity: 0.5;
      cursor: default;
      transform: none;
      box-shadow: none;
    }

    /* Seed bank */
    #seed-bank {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .seed-card {
      width: 100px;
      height: 64px;
      border-radius: 10px;
      background: linear-gradient(145deg, #f7f7c1, #f0e5a2);
      border: 2px solid #c1b676;
      box-shadow: 0 3px 0 #8c8151;
      position: relative;
      padding: 4px 6px;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      color: #332b1a;
      user-select: none;
      transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.1s;
    }

    .seed-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 0 #8c8151;
      filter: brightness(1.05);
    }

    .seed-card.selected {
      box-shadow: 0 0 0 2px #00ff99, 0 3px 0 #8c8151;
    }

    .seed-name {
      font-weight: 700;
    }

    .seed-cost {
      font-size: 11px;
      opacity: 0.85;
    }

    /* Board */
    #board {
      position: relative;
      width: 720px; /* 9 cols * 80px */
      height: 400px; /* 5 rows * 80px */
      border-radius: 12px;
      overflow: hidden;
      border: 2px solid rgba(255,255,255,0.2);
      background: linear-gradient(180deg, #4b7a2d, #32511f);
      box-shadow: inset 0 0 12px rgba(0,0,0,0.6);
    }

    #grid {
      display: grid;
      grid-template-columns: repeat(9, 1fr);
      grid-template-rows: repeat(5, 1fr);
      width: 100%;
      height: 100%;
      position: relative;
      z-index: 1;
    }

    .cell {
      border: 1px solid rgba(0,0,0,0.2);
      background: rgba(255,255,255,0.04);
      position: relative;
      cursor: pointer;
    }

    .cell:nth-child(odd) {
      background: rgba(255,255,255,0.03);
    }

    .cell:hover {
      outline: 2px solid rgba(255,255,255,0.3);
      outline-offset: -2px;
    }

    .plant {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #7ef57e, #2d8a2d);
      border: 2px solid #1a541a;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 0 10px rgba(0,0,0,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #032403;
      font-size: 22px;
      font-weight: 900;
      text-shadow: 0 0 4px rgba(255,255,255,0.6);
    }

    .plant.sunflower {
      background: radial-gradient(circle at 30% 20%, #ffe97a, #d68a1f);
      color: #5c3404;
    }

    .plant.wallnut {
      background: radial-gradient(circle at 30% 20%, #c49b6b, #79532e);
      color: #301b08;
    }

    #entities {
      position: absolute;
      inset: 0;
      z-index: 2;
      pointer-events: none; /* do not block clicks on cells */
    }

    .zombie {
      position: absolute;
      width: 70px;
      height: 80px;
      border-radius: 10px;
      background: linear-gradient(180deg, #719c61, #3e5a37);
      border: 2px solid #20331f;
      box-shadow: 0 0 10px rgba(0,0,0,0.7);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #e1ffe1;
      font-size: 14px;
    }

    .zombie::before {
      content: "ðŸ§Ÿ";
      font-size: 24px;
      margin-bottom: 2px;
    }

    .shot-flash {
      position: absolute;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: radial-gradient(circle, #c7ff4f, #4baa10);
      box-shadow: 0 0 10px rgba(190,255,90,0.9);
      opacity: 0.9;
      transform: translate(-50%, -50%);
      pointer-events: none;
    }

    #overlay-message {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.55);
      z-index: 5;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease;
    }

    #overlay-message.visible {
      opacity: 1;
      pointer-events: all;
    }

    #overlay-box {
      padding: 16px 20px;
      border-radius: 14px;
      background: rgba(0,0,0,0.85);
      border: 1px solid rgba(255,255,255,0.2);
      text-align: center;
      max-width: 260px;
    }

    #overlay-box h2 {
      margin-bottom: 10px;
      font-size: 18px;
    }

    #overlay-box p {
      font-size: 13px;
      margin-bottom: 12px;
      opacity: 0.9;
    }

    /* Mobile tweaks */
    @media (max-width: 760px) {
      #board {
        width: 100%;
        height: calc(100vw * (400 / 720)); /* keep aspect ratio */
      }
      #game-container {
        width: 100%;
        max-width: 760px;
        margin: 8px;
      }
      .seed-card {
        width: 90px;
        height: 60px;
      }
    }
  </style>
</head>
<body>
  <div id="game-container">
    <h1>Plants vs Zombies â€“ Tile Clone</h1>

    <div id="top-bar">
      <div id="sun-counter">â˜€ Sun: <span id="sun-amount">150</span></div>
      <div id="status-text">Click a seed, then click a tile to place a plant.</div>
      <button id="start-button">Start Wave</button>
    </div>

    <div id="seed-bank">
      <div class="seed-card selected" data-plant="peashooter" data-cost="100">
        <div class="seed-name">Peashooter</div>
        <div class="seed-cost">Cost: 100 â˜€</div>
        <div style="font-size:11px; opacity:0.8;">Shoots zombie in its tile.</div>
      </div>

      <div class="seed-card" data-plant="sunflower" data-cost="50">
        <div class="seed-name">Sunflower</div>
        <div class="seed-cost">Cost: 50 â˜€</div>
        <div style="font-size:11px; opacity:0.8;">Generates extra sun.</div>
      </div>

      <div class="seed-card" data-plant="wallnut" data-cost="50">
        <div class="seed-name">Wall-nut</div>
        <div class="seed-cost">Cost: 50 â˜€</div>
        <div style="font-size:11px; opacity:0.8;">High HP shield.</div>
      </div>
    </div>

    <div id="board">
      <div id="grid"></div>
      <div id="entities"></div>

      <div id="overlay-message">
        <div id="overlay-box">
          <h2 id="overlay-title">Game Over</h2>
          <p id="overlay-desc">The zombies ate your brains...</p>
          <button id="restart-button">Restart</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /***********************
     * BASIC CONSTANTS
     ***********************/
    const ROWS = 5;
    const COLS = 9;
    const CELL_SIZE = 80; // each tile is 80x80

    const PLANT_TYPES = {
      peashooter: {
        name: "Peashooter",
        cost: 100,
        reloadTime: 1.2,   // seconds between shots
        bulletDamage: 20,
        hp: 100
      },
      sunflower: {
        name: "Sunflower",
        cost: 50,
        generateInterval: 6, // seconds between suns
        hp: 80
      },
      wallnut: {
        name: "Wall-nut",
        cost: 50,
        hp: 320
      }
    };

    const ZOMBIE_CONFIG = {
      maxHp: 100,
      stepTime: 1.4,          // seconds to move one tile left
      biteDps: 18,            // damage per second to plant in same tile
      spawnIntervalMin: 3,
      spawnIntervalMax: 5
    };

    /***********************
     * DOM ELEMENTS
     ***********************/
    const gridEl = document.getElementById("grid");
    const entitiesEl = document.getElementById("entities");
    const sunAmountEl = document.getElementById("sun-amount");
    const statusTextEl = document.getElementById("status-text");
    const startButton = document.getElementById("start-button");
    const seedCards = document.querySelectorAll(".seed-card");
    const overlay = document.getElementById("overlay-message");
    const overlayTitle = document.getElementById("overlay-title");
    const overlayDesc = document.getElementById("overlay-desc");
    const restartButton = document.getElementById("restart-button");

    /***********************
     * GAME STATE
     ***********************/
    let cells = [];          // [row][col] => cell element
    let plants = [];         // {row, col, type, hp, reload, generateTimer, el}
    let zombies = [];        // {row, col, hp, stepTimer, el}
    let sun = 150;
    let currentPlantType = "peashooter";

    let running = false;
    let lastTime = null;
    let zombieSpawnTimer = 0;
    let nextSpawnTime = 999;  // set when wave starts
    let gameOver = false;
    let waveStarted = false;

    /***********************
     * INITIAL SETUP
     ***********************/
    function createGrid() {
      for (let r = 0; r < ROWS; r++) {
        cells[r] = [];
        for (let c = 0; c < COLS; c++) {
          const cell = document.createElement("div");
          cell.className = "cell";
          cell.dataset.row = r;
          cell.dataset.col = c;
          cell.addEventListener("click", onCellClick);
          gridEl.appendChild(cell);
          cells[r][c] = cell;
        }
      }
    }

    createGrid();
    updateSunDisplay();

    /***********************
     * INPUT HANDLING
     ***********************/
    seedCards.forEach(card => {
      card.addEventListener("click", () => {
        seedCards.forEach(c => c.classList.remove("selected"));
        card.classList.add("selected");
        currentPlantType = card.dataset.plant;
        statusTextEl.textContent = `Selected: ${PLANT_TYPES[currentPlantType].name}. Click a tile to place.`;
      });
    });

    function onCellClick(e) {
      if (gameOver) return;
      const cell = e.currentTarget;
      const row = parseInt(cell.dataset.row, 10);
      const col = parseInt(cell.dataset.col, 10);

      // check if cell already has plant
      if (plants.some(p => p.row === row && p.col === col)) {
        statusTextEl.textContent = "There's already a plant in that tile.";
        return;
      }

      const plantConfig = PLANT_TYPES[currentPlantType];
      if (!plantConfig) return;

      if (sun < plantConfig.cost) {
        statusTextEl.textContent = "Not enough sun!";
        return;
      }

      sun -= plantConfig.cost;
      updateSunDisplay();
      placePlant(row, col, currentPlantType);
      statusTextEl.textContent = `${plantConfig.name} planted.`;
    }

    /***********************
     * PLANTS
     ***********************/
    function placePlant(row, col, type) {
      const cell = cells[row][col];

      const plantEl = document.createElement("div");
      plantEl.className = "plant";
      plantEl.dataset.type = type;

      let label = "";
      if (type === "peashooter") {
        label = "P";
      } else if (type === "sunflower") {
        plantEl.classList.add("sunflower");
        label = "S";
      } else if (type === "wallnut") {
        plantEl.classList.add("wallnut");
        label = "W";
      }
      plantEl.textContent = label;

      cell.appendChild(plantEl);

      const conf = PLANT_TYPES[type];

      const plant = {
        row,
        col,
        type,
        hp: conf.hp,
        reload: 0,
        generateTimer: conf.generateInterval || 0,
        el: plantEl
      };

      plants.push(plant);
    }

    function flashPlantShot(plant) {
      if (!plant.el) return;
      // shake/scale the plant
      plant.el.style.transform = "translate(-50%, -50%) scale(1.1)";
      setTimeout(() => {
        if (plant.el) {
          plant.el.style.transform = "translate(-50%, -50%) scale(1)";
        }
      }, 120);

      // small flash on tile
      const flash = document.createElement("div");
      flash.className = "shot-flash";
      const x = plant.col * CELL_SIZE + CELL_SIZE / 2;
      const y = plant.row * CELL_SIZE + CELL_SIZE / 2;
      flash.style.left = x + "px";
      flash.style.top = y + "px";
      entitiesEl.appendChild(flash);
      setTimeout(() => {
        if (flash.parentNode) flash.parentNode.removeChild(flash);
      }, 140);
    }

    /***********************
     * ZOMBIES
     ***********************/
    function spawnZombie() {
      const row = Math.floor(Math.random() * ROWS);
      const zombieEl = document.createElement("div");
      zombieEl.className = "zombie";
      entitiesEl.appendChild(zombieEl);

      const z = {
        row,
        col: COLS, // start just off-board to the right
        hp: ZOMBIE_CONFIG.maxHp,
        stepTimer: 0,
        el: zombieEl
      };

      zombies.push(z);
      updateZombieElementPosition(z);
    }

    function updateZombieElementPosition(z) {
      const x = z.col * CELL_SIZE + (CELL_SIZE - 70) / 2;
      const y = z.row * CELL_SIZE + (CELL_SIZE - 80) / 2;
      z.el.style.left = x + "px";
      z.el.style.top = y + "px";
    }

    function scheduleNextZombieSpawn() {
      const min = ZOMBIE_CONFIG.spawnIntervalMin;
      const max = ZOMBIE_CONFIG.spawnIntervalMax;
      nextSpawnTime = min + Math.random() * (max - min);
      zombieSpawnTimer = 0;
    }

    /***********************
     * SUN
     ***********************/
    function updateSunDisplay() {
      sunAmountEl.textContent = sun;
    }

    /***********************
     * GAME LOOP
     ***********************/
    function gameLoop(timestamp) {
      if (!running) return;

      if (!lastTime) lastTime = timestamp;
      const delta = (timestamp - lastTime) / 1000; // seconds
      lastTime = timestamp;

      if (!gameOver) {
        updatePlants(delta);
        updateZombies(delta);
        handleSpawning(delta);
      }

      requestAnimationFrame(gameLoop);
    }

    function updatePlants(delta) {
      // We might remove plants while iterating, so copy first
      for (let i = plants.length - 1; i >= 0; i--) {
        const plant = plants[i];
        const config = PLANT_TYPES[plant.type];

        // Sunflower: generate sun
        if (plant.type === "sunflower") {
          plant.generateTimer -= delta;
          if (plant.generateTimer <= 0) {
            sun += 25;
            updateSunDisplay();
            plant.generateTimer = config.generateInterval;
          }
        }

        // Peashooter: only shoot when zombie is in same tile
        if (plant.type === "peashooter") {
          plant.reload -= delta;
          const targetZombie = zombies.find(z => z.row === plant.row && z.col === plant.col);
          if (targetZombie && plant.reload <= 0) {
            targetZombie.hp -= config.bulletDamage;
            flashPlantShot(plant);
            plant.reload = config.reloadTime;

            if (targetZombie.hp <= 0) {
              removeZombie(targetZombie);
              sun += 25; // small reward
              updateSunDisplay();
            }
          }
        }

        // Check if plant died from zombie biting
        if (plant.hp <= 0) {
          removePlant(plant);
        }
      }
    }

    function updateZombies(delta) {
      for (let i = zombies.length - 1; i >= 0; i--) {
        const z = zombies[i];

        // Check if zombie is sharing tile with a plant
        const plant = plants.find(p => p.row === z.row && p.col === z.col);

        if (plant) {
          // Zombie eats plant instead of moving
          plant.hp -= ZOMBIE_CONFIG.biteDps * delta;
          updateZombieElementPosition(z);
          continue;
        }

        // No plant in this tile -> move left tile-by-tile
        z.stepTimer -= delta;
        if (z.stepTimer <= 0) {
          z.col -= 1;
          z.stepTimer += ZOMBIE_CONFIG.stepTime;

          // If zombie reaches left of board -> game over
          if (z.col < 0) {
            triggerGameOver(false);
            return;
          }
        }

        updateZombieElementPosition(z);
      }
    }

    function handleSpawning(delta) {
      if (!waveStarted) return;
      zombieSpawnTimer += delta;

      if (zombieSpawnTimer >= nextSpawnTime) {
        spawnZombie();
        scheduleNextZombieSpawn();
      }
    }

    /***********************
     * REMOVE HELPERS
     ***********************/
    function removeZombie(zombie) {
      const idx = zombies.indexOf(zombie);
      if (idx !== -1) {
        const z = zombies[idx];
        if (z.el && z.el.parentNode) {
          z.el.parentNode.removeChild(z.el);
        }
        zombies.splice(idx, 1);
      }
    }

    function removePlant(plant) {
      const idx = plants.indexOf(plant);
      if (idx !== -1) {
        const p = plants[idx];
        if (p.el && p.el.parentNode) {
          p.el.parentNode.removeChild(p.el);
        }
        plants.splice(idx, 1);
      }
    }

    /***********************
     * GAME OVER / RESTART
     ***********************/
    function triggerGameOver(playerWon) {
      gameOver = true;
      running = false;

      overlayTitle.textContent = playerWon ? "You survived!" : "Game Over";
      overlayDesc.textContent = playerWon
        ? "The wave of zombies has been held back... for now."
        : "The zombies reached your house and ate your brains.";
      overlay.classList.add("visible");
      statusTextEl.textContent = "Game finished. Press Restart to play again.";
    }

    function resetGameState() {
      // clear entities
      plants.forEach(p => {
        if (p.el && p.el.parentElement) {
          p.el.parentElement.removeChild(p.el);
        }
      });
      zombies.forEach(z => z.el && z.el.remove());

      plants = [];
      zombies = [];
      sun = 150;
      updateSunDisplay();
      currentPlantType = "peashooter";
      seedCards.forEach(c => c.classList.remove("selected"));
      document.querySelector('.seed-card[data-plant="peashooter"]').classList.add("selected");

      lastTime = null;
      zombieSpawnTimer = 0;
      nextSpawnTime = 999;
      gameOver = false;
      waveStarted = false;
      overlay.classList.remove("visible");

      statusTextEl.textContent = "Click a seed, then click a tile to place a plant.";
    }

    /***********************
     * BUTTON HANDLERS
     ***********************/
    startButton.addEventListener("click", () => {
      if (waveStarted) {
        statusTextEl.textContent = "Wave already started! Hold the line!";
        return;
      }
      waveStarted = true;
      running = true;
      scheduleNextZombieSpawn();
      statusTextEl.textContent = "Wave started! Zombies move tile by tile from the right.";
      requestAnimationFrame(gameLoop);
    });

    restartButton.addEventListener("click", () => {
      resetGameState();
      running = true;
      requestAnimationFrame(gameLoop);
    });

    // Auto-start loop so animations run even before wave
    running = true;
    requestAnimationFrame(gameLoop);
  </script>
</body>
</html>